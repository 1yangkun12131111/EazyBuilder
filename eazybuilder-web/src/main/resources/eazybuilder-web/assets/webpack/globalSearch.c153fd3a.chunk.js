(this.webpackJsonp=this.webpackJsonp||[]).push([[158],{FqZL:function(t,e,o){"use strict";o.d(e,"a",(function(){return a})),o.d(e,"b",(function(){return i}));o("G3fq");var n=o("FxFN"),r=o("0AwG");const s=7;function a(t){const e="string"==typeof t?Object(n.e)(t):t;return"bg".concat(e%s+1)}function i(t){return Object(r.i)(t)||" "}},FxFN:function(t,e,o){"use strict";o.d(e,"e",(function(){return c})),o.d(e,"a",(function(){return l})),o.d(e,"c",(function(){return h})),o.d(e,"d",(function(){return u})),o.d(e,"b",(function(){return p}));o("S26F");var n=o("P/Kr"),r=o.n(n);function s(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,n)}return o}function a(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?s(Object(o),!0).forEach((function(e){i(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):s(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function i(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}const c=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return parseInt("".concat(t).replace(/gid:\/\/gitlab\/.*\//g,""),10)||null},l={Append:"APPEND",Remove:"REMOVE",Replace:"REPLACE"},h=function(t,e){if("string"!=typeof t)throw new TypeError("type must be a string; got ".concat(typeof t));if(!["number","string"].includes(typeof e))throw new TypeError("id must be a number or string; got ".concat(typeof e));return"gid://gitlab/".concat(t,"/").concat(e)},u=function(t,e){return e.map((function(e){return h(t,e)}))},p=function(t){if(!r()(t))throw new TypeError("nodes must be an array; got ".concat(typeof t));return t.map((function(t){return t.id?a(a({},t),{},{id:c(t.id)}):t}))}},K3ll:function(t,e,o){"use strict";o.r(e),o.d(e,"SearchAutocomplete",(function(){return b})),o.d(e,"default",(function(){return f}));o("orcL");var n=o("h7kv"),r=o.n(n),s=o("G3fq"),a=o.n(s),i=o("EmJ/"),c=o.n(i),l=o("m/7A"),h=o("FqZL"),u=o("/lV4"),p=o("4ZIW"),d=o("2ibD"),g=o("NmEs");const m={ESCAPE:27,BACKSPACE:8,ENTER:13,UP:38,DOWN:40};class b{constructor(){let{wrap:t,optsEl:e,autocompletePath:o,projectId:n,projectRef:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(){const t=c()(".js-search-project-options"),e=c()(".js-search-group-options"),o=c()(".js-search-dashboard-options");if(t.length){gl.projectOptions=gl.projectOptions||{};const e=t.data("projectPath");gl.projectOptions[e]={name:t.data("name"),issuesPath:t.data("issuesPath"),issuesDisabled:t.data("issuesDisabled"),mrPath:t.data("mrPath")}}if(e.length){gl.groupOptions=gl.groupOptions||{};const t=e.data("groupPath");gl.groupOptions[t]={name:e.data("name"),issuesPath:e.data("issuesPath"),mrPath:e.data("mrPath")}}o.length&&(gl.dashboardOptions={name:Object(u.e)("SearchAutocomplete|All GitLab"),issuesPath:o.data("issuesPath"),mrPath:o.data("mrPath")})}(),this.bindEventContext(),this.wrap=t||c()(".search"),this.optsEl=e||this.wrap.find(".search-autocomplete-opts"),this.autocompletePath=o||this.optsEl.data("autocompletePath"),this.projectId=n||this.optsEl.data("autocompleteProjectId")||"",this.projectRef=r||this.optsEl.data("autocompleteProjectRef")||"",this.dropdown=this.wrap.find(".dropdown"),this.dropdownToggle=this.wrap.find(".js-dropdown-search-toggle"),this.dropdownMenu=this.dropdown.find(".dropdown-menu"),this.dropdownContent=this.dropdown.find(".dropdown-content"),this.scopeInputEl=this.getElement("#scope"),this.searchInput=this.getElement(".search-input"),this.projectInputEl=this.getElement("#search_project_id"),this.groupInputEl=this.getElement("#group_id"),this.searchCodeInputEl=this.getElement("#search_code"),this.repositoryInputEl=this.getElement("#repository_ref"),this.clearInput=this.getElement(".js-clear-input"),this.scrollFadeInitialized=!1,this.saveOriginalState(),gon.current_user_id&&this.createAutocomplete(),this.bindEvents(),this.dropdownToggle.dropdown(),this.searchInput.addClass("js-autocomplete-disabled")}bindEventContext(){this.onSearchInputBlur=this.onSearchInputBlur.bind(this),this.onClearInputClick=this.onClearInputClick.bind(this),this.onSearchInputFocus=this.onSearchInputFocus.bind(this),this.onSearchInputKeyUp=this.onSearchInputKeyUp.bind(this),this.onSearchInputChange=this.onSearchInputChange.bind(this),this.setScrollFade=this.setScrollFade.bind(this)}getElement(t){return this.wrap.find(t)}saveOriginalState(){return this.originalState=this.serializeState()}createAutocomplete(){return Object(l.a)(this.searchInput,{filterInputBlur:!1,filterable:!0,filterRemote:!0,highlight:!0,icon:!0,enterCallback:!1,filterInput:"input#search",search:{fields:["text"]},id:this.getSearchText,data:this.getData.bind(this),selectable:!0,clicked:this.onClick.bind(this),trackSuggestionClickedLabel:"search_autocomplete_suggestion"})}getSearchText(t){return t.id?t.text:""}getData(t,e){var o=this;if(t){if(!this.loadingSuggestions)return this.loadingSuggestions=!0,d.a.get(this.autocompletePath,{params:{project_id:this.projectId,project_ref:this.projectRef,term:t}}).then((function(n){const r=o.scopedSearchOptions(t);let s=null;for(let t=0,e=n.data.length;t<e;t+=1){const e=n.data[t];s!==e.category&&(r.push({type:"separator"}),r.push({type:"header",content:e.category}),s=e.category),r.push({id:"".concat(e.category.toLowerCase(),"-").concat(e.id),icon:o.getAvatar(e),category:e.category,text:e.label,url:e.url})}e(r),o.loadingSuggestions=!1,o.highlightFirstRow(),o.setScrollFade()})).catch((function(){o.loadingSuggestions=!1}))}else{const t=this.getCategoryContents();if(t){const e=this.searchInput.data("deprecatedJQueryDropdown");e&&e.filter.options.callback(t),this.enableAutocomplete()}}}getCategoryContents(){const t=gon.current_username,{projectOptions:e,groupOptions:o,dashboardOptions:n}=gl;let r;Object(g.D)()&&e?r=e[Object(g.q)()]:Object(g.z)()&&o?r=o[Object(g.n)()]:n&&(r=n);const{issuesPath:s,mrPath:a,name:i,issuesDisabled:c}=r,l=[];i&&l.push({type:"header",content:"".concat(i)});const h=[{text:Object(u.e)("SearchAutocomplete|Issues assigned to me"),url:"".concat(s,"/?assignee_username=").concat(t)},{text:Object(u.e)("SearchAutocomplete|Issues I've created"),url:"".concat(s,"/?author_username=").concat(t)}],p=[{text:Object(u.e)("SearchAutocomplete|Merge requests assigned to me"),url:"".concat(a,"/?assignee_username=").concat(t)},{text:Object(u.e)("SearchAutocomplete|Merge requests that I'm a reviewer"),url:"".concat(a,"/?reviewer_username=").concat(t)},{text:Object(u.e)("SearchAutocomplete|Merge requests I've created"),url:"".concat(a,"/?author_username=").concat(t)}];let d;return d=c?l.concat(p):l.concat(...h,...p)}scopedSearchOptions(t){const e=Object(g.T)("search","s16 inline-search-icon"),o=this.projectInputEl.val(),n=this.groupInputEl.val(),r=[];if(o){const s=gl.projectOptions[Object(g.q)()],a=n?"".concat(gon.relative_url_root,"/search?search=").concat(t,"&project_id=").concat(o,"&group_id=").concat(n):"".concat(gon.relative_url_root,"/search?search=").concat(t,"&project_id=").concat(o);r.push({icon:e,text:t,template:Object(u.f)(Object(u.e)("SearchAutocomplete|in project %{projectName}"),{projectName:"<i>".concat(s.name,"</i>")},!1),url:a})}if(n){const o=gl.groupOptions[Object(g.n)()];r.push({icon:e,text:t,template:Object(u.f)(Object(u.e)("SearchAutocomplete|in group %{groupName}"),{groupName:"<i>".concat(o.name,"</i>")},!1),url:"".concat(gon.relative_url_root,"/search?search=").concat(t,"&group_id=").concat(n)})}return r.push({icon:e,text:t,template:Object(u.e)("SearchAutocomplete|in all GitLab"),url:"".concat(gon.relative_url_root,"/search?search=").concat(t)}),r}serializeState(){return{search_project_id:this.projectInputEl.val(),group_id:this.groupInputEl.val(),search_code:this.searchCodeInputEl.val(),repository_ref:this.repositoryInputEl.val(),scope:this.scopeInputEl.val()}}bindEvents(){this.searchInput.on("input",this.onSearchInputChange),this.searchInput.on("keyup",this.onSearchInputKeyUp),this.searchInput.on("focus",this.onSearchInputFocus),this.searchInput.on("blur",this.onSearchInputBlur),this.clearInput.on("click",this.onClearInputClick),this.dropdownContent.on("scroll",r()(this.setScrollFade,250)),this.searchInput.on("click",(function(t){t.stopPropagation()}))}enableAutocomplete(){if(this.setScrollFade(),gon.current_user_id&&!this.dropdown.hasClass("show")){this.loadingSuggestions=!1,this.dropdownToggle.dropdown("toggle");const t="click_search_bar",e=void 0;return p.a.event(e,t,{label:"main_navigation",property:"navigation"}),this.searchInput.removeClass("js-autocomplete-disabled")}}onSearchInputChange(){this.enableAutocomplete()}onSearchInputKeyUp(t){switch(t.keyCode){case m.ESCAPE:this.restoreOriginalState();break;case m.ENTER:this.disableAutocomplete()}this.wrap.toggleClass("has-value",Boolean(t.target.value))}onSearchInputFocus(){if(this.isFocused=!0,this.wrap.addClass("search-active"),""===this.getValue())return this.getData()}getValue(){return this.searchInput.val()}onClearInputClick(t){return t.preventDefault(),this.wrap.toggleClass("has-value",Boolean(t.target.value)),this.searchInput.val("").focus()}onSearchInputBlur(){this.isFocused=!1,this.wrap.removeClass("search-active"),""===this.searchInput.val()&&this.restoreOriginalState(),this.dropdownMenu.removeClass("show")}restoreOriginalState(){const t=Object.keys(this.originalState);for(let e=0,o=t.length;e<o;e+=1){const o=t[e];this.getElement("#".concat(o)).val(this.originalState[o])}}resetSearchState(){const t=Object.keys(this.originalState),e=[];for(let o=0,n=t.length;o<n;o+=1){const n=t[o];e.push(this.getElement("#".concat(n)).val(""))}return e}disableAutocomplete(){!this.searchInput.hasClass("js-autocomplete-disabled")&&this.dropdown.hasClass("show")&&(this.searchInput.addClass("js-autocomplete-disabled"),this.dropdownToggle.dropdown("toggle"),this.restoreMenu())}restoreMenu(){const t='<ul><li class="dropdown-menu-empty-item"><a>'.concat(Object(u.a)("Loading..."),"</a></li></ul>");return this.dropdownContent.html(t)}onClick(t,e,o){if(-1!==window.location.pathname.indexOf(t.url))return o.metaKey||o.preventDefault(),"Projects"===t.category&&this.projectInputEl.val(t.id),"Groups"===t.category&&this.groupInputEl.val(t.id),e.removeClass("is-active"),this.disableAutocomplete(),this.searchInput.val("").focus()}highlightFirstRow(){this.searchInput.data("deprecatedJQueryDropdown").highlightRowAtIndex(null,0)}getAvatar(t){if(!Object.hasOwnProperty.call(t,"avatar_url"))return!1;const{label:e,id:o}=t,n=t.avatar_url;return n?'<img class="search-item-avatar" src="'.concat(n,'" />'):'<div class="s16 avatar identicon '.concat(Object(h.a)(o),'">').concat(Object(h.b)(a()(e)),"</div>")}isScrolledUp(){const t=this.dropdownContent[0];return this.contentClientHeight+t.scrollTop<this.maxPosition}initScrollFade(){const t=this.dropdownContent[0];this.scrollFadeInitialized=!0,this.contentClientHeight=t.clientHeight,this.maxPosition=t.scrollHeight,this.dropdownMenu.addClass("dropdown-content-faded-mask")}setScrollFade(){this.initScrollFade(),this.dropdownMenu.toggleClass("fade-out",!this.isScrolledUp())}}function f(t){return new b(t)}}}]);
//# sourceMappingURL=globalSearch.c153fd3a.chunk.js.map