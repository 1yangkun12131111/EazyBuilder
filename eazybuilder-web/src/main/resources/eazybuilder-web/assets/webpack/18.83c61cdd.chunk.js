(this.webpackJsonp=this.webpackJsonp||[]).push([[18],{YqVM:function(e,t,n){var a=n("nHTl"),s=n("dA+0");e.exports=function(e,t){return e&&e.length?s(e,a(t,2)):[]}},yYhH:function(e,t,n){"use strict";n.r(t);n("jaBk"),n("GzNv"),n("QifN"),n("l9AF"),n("S26F"),n("+xeR"),n("orcL");var a=n("YqVM"),s=n.n(a),r=n("05sH"),i=n.n(r),l=n("G3fq"),o=n.n(l),c=n("EmJ/"),u=n.n(c);const d={projectId:"projectId",groupId:"groupId",showCurrentUser:"currentUser",authorId:"authorId",skipUsers:"skipUsers"},f={project_id:"projectId",group_id:"groupId",skip_ldap:"skipLdap",todo_filter:"todoFilter",todo_state_filter:"todoStateFilter",current_user:"showCurrentUser",author_id:"authorId",skip_users:"skipUsers"};var m=n("m/7A"),p=n("NY3P"),h=n("nc9B"),g=n("2ibD"),v=n("NmEs"),b=n("qnJZ"),j=n("/lV4");const y=function(e,t){return Object.keys(t).reduce((function(n,a){const s=t[a];return n[a]=e.data(s),n}),{})};function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _(e,t){var a=this;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const l=null==t?void 0:t.toString().match(".(.+$)")[1],c=u()(t||".js-user-search");this.users=this.users.bind(this),this.user=this.user.bind(this),this.usersPath="/-/autocomplete/users.json",this.userPath="/-/autocomplete/users/:id.json",null!=e&&(this.currentUser="object"==typeof e?e:JSON.parse(e));const{handleClick:f}=r,p=this;c.each((function(e,t){const n=a,r={},c=u()(t);r.projectId=c.data("projectId"),r.groupId=c.data("groupId"),r.showCurrentUser=c.data("currentUser"),r.todoFilter=c.data("todoFilter"),r.todoStateFilter=c.data("todoStateFilter"),r.iid=c.data("iid"),r.issuableType=c.data("issuableType"),r.targetBranch=c.data("targetBranch");const d=c.data("nullUser"),p=c.data("nullUserDefault"),b=c.data("showMenuAbove"),y=c.data("anyUser"),w=c.data("firstUser");r.authorId=c.data("authorId");const O=c.data("defaultLabel"),_=c.data("issueUpdate"),S=c.closest(".selectbox"),U=S.next(".assign-to-me-link");let C=S.closest(".block");const x=c.data("abilityName");let k=C.find(".value");const I=C.find(".sidebar-collapsed-user"),N=C.find(".block-loading").addClass("gl-display-none"),D=p&&d?0:null;let A,E,R,T=c.data("selected");void 0===T&&(T=D);const P=function(){const e=c.closest(".selectbox").find("input[name='".concat(c.data("fieldName"),"'][value=0]"));e&&e.remove();const t=c.data("currentUserInfo")||{},a=n.currentUser||{},s=c.data("fieldName"),r=t.name,l=t.id||a.id,o=i()('\n        <input type="hidden" name="<%- fieldName %>"\n          data-meta="<%- userName %>"\n          value="<%- userId %>" />\n        ')({fieldName:s,userName:r,userId:l});S?c.parent().before(o):c.after(o)};C[0]&&C[0].addEventListener("assignYourself",P);const q=function(){return S.find('input[name="'.concat(c.data("fieldName"),'"]'))},L=function(){return q().map((function(e,t){return parseInt(t.value,10)})).get()},M=function(){const e=c.data("maxSelect");if(e){const t=L();if(t.length>e){const e=t[0];c.closest(".selectbox").find("input[name='".concat(c.data("fieldName"),"'][value=").concat(e,"]")).remove(),c.hasClass(l)?emitSidebarEvent("sidebar.removeReviewer",{id:e}):emitSidebarEvent("sidebar.removeAssignee",{id:e})}}},F=function(e,t){const n=L().filter((function(e){return 0!==e})),a=q().map((function(e,t){return{name:t.dataset.meta,value:parseInt(t.value,10)}})).filter((function(e){return 0!==e.id})).get(0);if(0===n.length)return Object(j.e)("UsersSelect|Unassigned");if(1===n.length)return a.name;if(t){const t=n.filter((function(t){return t!==e.id}));return Object(j.f)(Object(j.e)("UsersSelect|%{name} + %{length} more"),{name:e.name,length:t.length})}return Object(j.f)(Object(j.e)("UsersSelect|%{name} + %{length} more"),{name:a.name,length:n.length-1})};return U.on("click",(function(e){if(e.preventDefault(),u()(e.currentTarget).hide(),c.data("multiSelect")){P(),M();const e=c.data("currentUserInfo");c.find(".dropdown-toggle-text").text(F(e)).removeClass("is-default")}else{const e=u()('input[name="'.concat(c.data("fieldName"),'"]'));e.val(gon.current_user_id),T=e.val(),c.find(".dropdown-toggle-text").text(gon.current_user_fullname).removeClass("is-default")}})),C.on("click",".js-assign-yourself",(function(e){return e.preventDefault(),A(n.currentUser.id)})),A=function(e){const t={};return t[x]={},t[x].assignee_id=null!=e?e:null,N.removeClass("gl-display-none"),c.trigger("loading.gl.dropdown"),g.a.put(_,t).then((function(e){let{data:t}=e,n={},a=n.name;return c.trigger("loaded.gl.dropdown"),N.addClass("gl-display-none"),t.assignee?(n={name:t.assignee.name,username:t.assignee.username,avatar:t.assignee.avatar_url},a=o()(n.name)):(n={name:Object(j.e)("UsersSelect|Unassigned"),username:"",avatar:""},a=Object(j.e)("UsersSelect|Assignee")),k.html(E(n)),I.attr("title",a),Object(h.c)(I),I.html(R(n))}))},R=i()('<% if( avatar ) { %> <a class="author-link" href="/<%- username %>"> <img width="24" class="avatar avatar-inline s24" alt="" src="<%- avatar %>"> </a> <% } else { %> '.concat(Object(v.T)("user")," <% } %>")),E=i()('<% if (username) { %> <a class="author-link bold" href="/<%- username %>"> <% if( avatar ) { %> <img width="32" class="avatar avatar-inline s32" alt="" src="<%- avatar %>"> <% } %> <span class="author"><%- name %></span> <span class="username"> @<%- username %> </span> </a> <% } else { %> <span class="no-value assign-yourself">\n      '.concat(Object(j.f)(Object(j.e)("UsersSelect|No assignee - %{openingTag} assign yourself %{closingTag}"),{openingTag:'<a href="#" class="js-assign-yourself">',closingTag:"</a>"}),"</span> <% } %>")),Object(m.a)(c,{showMenuAbove:b,data(e,t){var a=this;return n.users(e,r,(function(n){(a.instance||a.options.instance).options.processData(e,n,t)}))},processData(e,t,n){const a=t.filter((function(e){return!e.type}));let r,i,l,o,u,f,m=a;if(c.hasClass("js-multiselect")&&0===e.length){const e=q(),t=s()(e,(function(e){return e.value})).filter((function(e){const t=parseInt(e.value,10);return!m.find((function(e){return e.id===t}))&&0!==t})).map((function(e){const t=parseInt(e.value,10),{avatarUrl:n,avatar_url:a,name:s,username:r,canMerge:i}=e.dataset;return{avatar_url:n||a||gon.default_avatar_url,id:t,name:s,username:r,can_merge:Object(v.K)(i)}}));m=a.concat(t)}if(0===e.length){if(f=0,w)for(i=0,l=m.length;i<l;i+=1)if((u=m[i]).username===w){m.splice(i,1),m.unshift(u);break}if(d&&(f+=1,m.unshift({beforeDivider:!0,name:Object(j.e)("UsersSelect|Unassigned"),id:0})),y&&(f+=1,!0===(o=y)&&(o=Object(j.e)("UsersSelect|Any User")),r={beforeDivider:!0,name:o,id:null},m.unshift(r)),f&&m.splice(f,0,{type:"divider"}),c.hasClass("js-multiselect")){const e=L().filter((function(e){return 0!==e}));if(e.length>0){c.data("dropdownHeader")&&(f+=1,m.splice(f,0,{type:"header",content:c.data("dropdownHeader")}));const t=m.filter((function(t){return-1!==e.indexOf(t.id)})).sort((function(e,t){return e.name>t.name}));m=m.filter((function(t){return-1===e.indexOf(t.id)})),t.forEach((function(e){f+=1,m.splice(f,0,e)})),m.splice(f+1,0,{type:"divider"})}}}n(m),b&&c.data("deprecatedJQueryDropdown").positionMenuAbove()},filterable:!0,filterRemote:!0,search:{fields:["name","username"]},selectable:!0,fieldName:c.data("fieldName"),toggleLabel(e,t,n){const a=n.filterInput.val();if(this.multiSelect&&""===a){const e=n.filteredFullData(),t=n.parseData.bind(n);this.processData(a,e,t)}return this.multiSelect?F(e,u()(t).hasClass("is-active")):e&&"id"in e&&u()(t).hasClass("is-active")?(c.find(".dropdown-toggle-text").removeClass("is-default"),e.text?e.text:e.name):(c.find(".dropdown-toggle-text").addClass("is-default"),O)},defaultLabel:O,hidden(){c.hasClass("js-multiselect")&&(c.hasClass(l)?emitSidebarEvent("sidebar.saveReviewers"):emitSidebarEvent("sidebar.saveAssignees")),c.data("alwaysShowSelectbox")||(S.hide(),C=S.closest(".block"),(k=C.find(".value")).css("display",""))},multiSelect:c.hasClass("js-multiselect"),inputMeta:c.data("inputMeta"),clicked(e){const{$el:t,e:n,isMarking:a}=e,s=e.selectedObj;if(Object(h.b)(t),c.hasClass("js-multiselect")){const e=t.hasClass("is-active"),n=c.closest(".selectbox").find("input[name='".concat(c.data("fieldName"),"'][value!=0]"));if(M(),s.beforeDivider&&"unassigned"===s.name.toLowerCase())n.each((function(e,t){t.remove()})),c.hasClass(l)?emitSidebarEvent("sidebar.removeAllReviewers"):emitSidebarEvent("sidebar.removeAllAssignees");else if(e){c.hasClass(l)?emitSidebarEvent("sidebar.addReviewer",s):emitSidebarEvent("sidebar.addAssignee",s);const e=c.closest(".selectbox").find("input[name='".concat(c.data("fieldName"),"'][value=0]"));e&&e.remove()}else 0===n.length&&this.addInput(c.data("fieldName"),0,{}),c.hasClass(l)?emitSidebarEvent("sidebar.removeReviewer",s):emitSidebarEvent("sidebar.removeAssignee",s);L().find((function(e){return e===gon.current_user_id}))?U.hide():U.show()}const r=u()("body").attr("data-page"),i="projects:issues:index"===r,o=r==r&&"projects:merge_requests:index"===r;if(c.hasClass("js-filter-bulk-update")||c.hasClass("js-issuable-form-dropdown")){n.preventDefault();const e=s.id!==T;(T=e?s.id:D)===gon.current_user_id?u()(".assign-to-me-link").hide():u()(".assign-to-me-link").show()}else{if(f)n.preventDefault(),f(s,a);else{if(c.hasClass("js-filter-submit")&&(i||o))return Issuable.filterResults(c.closest("form"));if(c.hasClass("js-filter-submit"))return c.closest("form").submit();if(!c.hasClass("js-multiselect")){const e=c.closest(".selectbox").find("input[name='".concat(c.data("fieldName"),"']")).val();return A(e)}}c.data("maxSelect")&&L().length===c.data("maxSelect")&&c.dropdown("toggle")}},id:e=>e.id,opened(e){const t=u()(e.currentTarget),n=L();function a(e){t.find('li[data-user-id="'.concat(e,'"] .dropdown-menu-user-link')).addClass("is-active")}c.hasClass("js-issue-board-sidebar")&&0===n.length&&this.addInput(c.data("fieldName"),0,{}),t.find(".is-active").removeClass("is-active"),n.length>0?L().forEach((function(e){return a(e)})):c.hasClass("js-issue-board-sidebar")?a(0):a(T)},updateLabel:c.data("dropdownTitle"),renderRow(e){const t=e.username?"@".concat(e.username):"",a=e.avatar_url?e.avatar_url:gon.default_avatar_url;let s=!1;if(this.multiSelect){s=L().find((function(t){return e.id===t}));const{fieldName:t}=this;c.closest(".selectbox").find("input[name='".concat(t,"'][value='").concat(e.id,"']")).length&&(s=!0)}else s=e.id===T;let i="";return null!=e.beforeDivider?"<li><a href='#' class='".concat(!0===s?"is-active":"","'>").concat(o()(e.name),"</a></li>"):i="<img src='".concat(a,"' class='avatar avatar-inline m-0' width='32' />"),n.renderRow(r.issuableType,e,s,t,i,l)}})})),u()(".ajax-users-select").length&&n.e(443).then(n.t.bind(null,"p9g0",7)).then((function(){Object(b.a)(gon.select2_css_path).then((function(){u()(".ajax-users-select").each((function(e,t){const n=y(u()(t),d);n.skipLdap=u()(t).hasClass("skip_ldap");const a=u()(t).data("nullUser"),s=u()(t).data("anyUser"),r=u()(t).data("emailUser"),i=u()(t).data("firstUser");return u()(t).select2({placeholder:Object(j.a)("Search for a user"),multiple:u()(t).hasClass("multiselect"),minimumInputLength:0,query:e=>p.users(e.term,n,(function(t){let n;const l={results:t};if(0===e.term.length){if(i){const e=l.results;for(let t=0,n=e.length;t<n;t+=1){const n=e[t];if(n.username===i){l.results.splice(t,1),l.results.unshift(n);break}}}if(a){const e={name:Object(j.e)("UsersSelect|Unassigned"),id:0};l.results.unshift(e)}if(s){!0===(n=s)&&(n=Object(j.e)("UsersSelect|Any User"));const e={name:n,id:null};l.results.unshift(e)}}if(r&&0===l.results.length&&e.term.match(/^[^@]+@[^@]+$/)){const t=e.term.trim(),n={name:Object(j.f)(Object(j.a)('Invite "%{trimmed}" by email'),{trimmed:t}),username:t,id:t,invite:!0};l.results.unshift(n)}return e.callback(l)})),initSelection(){const e=1<=arguments.length?[].slice.call(arguments,0):[];return p.initSelection.apply(p,e)},formatResult(){const e=1<=arguments.length?[].slice.call(arguments,0):[];return p.formatResult.apply(p,e)},formatSelection(){const e=1<=arguments.length?[].slice.call(arguments,0):[];return p.formatSelection.apply(p,e)},dropdownCssClass:"ajax-users-dropdown",escapeMarkup:e=>e})}))})).catch((function(){}))})).catch((function(){}))}window.emitSidebarEvent=window.emitSidebarEvent||u.a.noop,_.prototype.initSelection=function(e,t){const n=u()(e).val();if("0"===n){return t({name:Object(j.e)("UsersSelect|Unassigned")})}if(""!==n)return this.user(n,t)},_.prototype.formatResult=function(e){let t=gon.default_avatar_url;return e.avatar_url&&(t=e.avatar_url),"\n    <div class='user-result'>\n      <div class='user-image'>\n        <img class='avatar avatar-inline s32' src='".concat(t,"'>\n      </div>\n      <div class='user-info'>\n        <div class='user-name dropdown-menu-user-full-name'>\n          ").concat(o()(e.name),"\n        </div>\n        <div class='user-username dropdown-menu-user-username text-secondary'>\n          ").concat(e.invite?"":"@".concat(o()(e.username)),"\n        </div>\n      </div>\n    </div>\n  ")},_.prototype.formatSelection=function(e){return o()(e.name)},_.prototype.user=function(e,t){if(!/^\d+$/.test(e))return!1;let n=this.buildUrl(this.userPath);return n=n.replace(":id",e),g.a.get(n).then((function(e){let{data:n}=e;t(n)}))},_.prototype.users=function(e,t,n){const a=this.buildUrl(this.usersPath),s=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){O(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({search:e,active:!0},function(e,t){return Object.keys(t).reduce((function(n,a){const s=t[a];return n[a]=e[s]||null,n}),{})}(t,f)),r="merge_request"===t.issuableType,i=!t.issuableType&&t.iid&&t.targetBranch,l=!t.issuableType&&!t.iid&&t.targetBranch;return(r||i||l)&&(s.merge_request_iid=t.iid||null,s.approval_rules=!0),l&&(s.target_branch=t.targetBranch||null),g.a.get(a,{params:s}).then((function(e){let{data:t}=e;n(t)}))},_.prototype.buildUrl=function(e){return null!=gon.relative_url_root&&(e=gon.relative_url_root.replace(/\/$/,"")+e),e},_.prototype.renderRow=function(e,t,n,a,s,r){const i="merge_request"!==e||t.can_merge?"":Object(j.a)("Cannot merge"),l=i?"has-tooltip":"",c="".concat(!0===n?"is-active":""," ").concat(l),u=i?'data-container="body" data-placement="left" data-title="'.concat(i,'"'):"",d=(null==t?void 0:t.availability)&&Object(p.a)(t.availability)?Object(j.f)(Object(j.a)("%{name} (Busy)"),{name:t.name}):t.name;return"\n    <li data-user-id=".concat(t.id,'>\n      <a href="#" class="dropdown-menu-user-link d-flex align-items-center ').concat(c,'" ').concat(u,">\n        ").concat(this.renderRowAvatar(e,t,s),'\n        <span class="d-flex flex-column overflow-hidden">\n          <strong class="dropdown-menu-user-full-name gl-font-weight-bold">\n            ').concat(o()(d),"\n          </strong>\n          ").concat(a?'<span class="dropdown-menu-user-username gl-text-gray-400">'.concat(a,"</span>"):"","\n          ").concat(this.renderApprovalRules(r,t.applicable_approval_rules),"\n        </span>\n      </a>\n    </li>\n  ")},_.prototype.renderRowAvatar=function(e,t,n){if(t.beforeDivider)return n;const a="merge_request"!==e||t.can_merge?"":Object(v.T)("warning-solid","s12 merge-icon");return'<span class="position-relative mr-2">\n    '.concat(n,"\n    ").concat(a,"\n  </span>")},_.prototype.renderApprovalRules=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const n=t.length;if(!(null==e?void 0:e.includes("reviewer"))||!n)return"";const[a]=t,s=Object(j.f)(Object(j.a)("(+%{count}&nbsp;rules)"),{count:n}),r=n>1?'<span class="ml-1">'.concat(s,"</span>"):"",i="code_owner"===a.rule_type?Object(j.a)("Code Owner"):a.name;return'<div class="gl-display-flex gl-font-sm">\n    <span class="gl-text-truncate" title="'.concat(i,'">').concat(i,"</span>\n    ").concat(r,"\n  </div>")};t.default=_}}]);
//# sourceMappingURL=18.83c61cdd.chunk.js.map