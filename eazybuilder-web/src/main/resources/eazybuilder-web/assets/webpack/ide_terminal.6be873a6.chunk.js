(this.webpackJsonp=this.webpackJsonp||[]).push([[160],{"1OWu":function(t,e,n){"use strict";n.d(e,"d",(function(){return i})),n.d(e,"a",(function(){return o})),n.d(e,"f",(function(){return s})),n.d(e,"c",(function(){return l})),n.d(e,"b",(function(){return a})),n.d(e,"g",(function(){return c})),n.d(e,"e",(function(){return u}));n("orcL"),n("7jeQ");var r=n("NmEs");const i=function(t){return Boolean(t&&t.scrollWidth>t.offsetWidth)},o=function(t,e){t&&t.classList.add(e)},s=function(){return Object(r.B)()||Object(r.y)()||Object(r.C)()},l=function(t){let{scrollTop:e}=t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e>n},a=function(t){let{scrollTop:e,offsetHeight:n,scrollHeight:r}=t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e+n<r-i},c=function(t,e){t&&Object.entries(e).map((function(e){let[n,r]=e;r?t.classList.add(n):t.classList.remove(n)}))},u=function(t){return Boolean(t.offsetWidth||t.offsetHeight||t.getClientRects().length)}},DTM5:function(t,e,n){"use strict";n.r(e);var r=n("4lAS"),i=n("yi8e"),o=n("/lV4"),s=n("sioD"),l=n("FkSe"),a=n("U0k0"),c=n("bQWb"),u={components:{ScrollButton:n("YNDB").a},props:{canScrollUp:{type:Boolean,required:!1,default:!1},canScrollDown:{type:Boolean,required:!1,default:!1}}},f=n("tBpV"),h=Object(f.a)(u,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"controllers"},[n("scroll-button",{attrs:{disabled:!t.canScrollUp,direction:"up"},on:{click:function(e){return t.$emit("scroll-up")}}}),t._v(" "),n("scroll-button",{attrs:{disabled:!t.canScrollDown,direction:"down"},on:{click:function(e){return t.$emit("scroll-down")}}})],1)}),[],!1,null,null,null).exports;function p(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function d(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?p(Object(n),!0).forEach((function(e){m(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function m(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var b={components:{GlLoadingIcon:l.a,TerminalControls:h},props:{terminalPath:{type:String,required:!1,default:""},status:{type:String,required:!0}},data:()=>({glterminal:null,canScrollUp:!1,canScrollDown:!1}),computed:d(d({},Object(i.f)(["panelResizing"])),{},{loadingText(){return Object(s.c)(this.status)?Object(o.a)("Starting..."):this.status===c.h?Object(o.a)("Stopping..."):""}}),watch:{panelResizing(){!this.panelResizing&&this.glterminal&&this.glterminal.fit()},status(){this.refresh()},terminalPath(){this.refresh()}},beforeDestroy(){this.destroyTerminal()},methods:{refresh(){this.status===c.e&&this.terminalPath?this.createTerminal():this.status===c.h&&this.stopTerminal()},createTerminal(){var t=this;this.destroyTerminal(),this.glterminal=new a.a(this.$refs.terminal),this.glterminal.addScrollListener((function(e){let{canScrollUp:n,canScrollDown:r}=e;t.canScrollUp=n,t.canScrollDown=r}))},destroyTerminal(){this.glterminal&&(this.glterminal.dispose(),this.glterminal=null)},stopTerminal(){this.glterminal&&this.glterminal.disable()}}};function O(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function g(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?O(Object(n),!0).forEach((function(e){j(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function j(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var v={components:{Terminal:Object(f.a)(b,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"d-flex flex-column flex-fill min-height-0 pr-3"},[n("div",{staticClass:"top-bar d-flex border-left-0 align-items-center"},[t.loadingText?n("div",{attrs:{"data-qa-selector":"loading_container"}},[n("gl-loading-icon",{attrs:{inline:!0}}),t._v(" "),n("span",[t._v(t._s(t.loadingText))])],1):t._e(),t._v(" "),t.glterminal?n("terminal-controls",{staticClass:"ml-auto",attrs:{"can-scroll-up":t.canScrollUp,"can-scroll-down":t.canScrollDown},on:{"scroll-up":function(e){return t.glterminal.scrollToTop()},"scroll-down":function(e){return t.glterminal.scrollToBottom()}}}):t._e()],1),t._v(" "),n("div",{staticClass:"terminal-wrapper d-flex flex-fill min-height-0"},[n("div",{ref:"terminal",staticClass:"ide-terminal-trace flex-fill min-height-0 w-100",attrs:{"data-project-path":t.terminalPath,"data-qa-selector":"terminal_screen"}})])])}),[],!1,null,null,null).exports,GlButton:r.a},computed:g(g({},Object(i.f)("terminal",["session"])),{},{actionButton(){var t=this;return Object(s.a)(this.session.status)?{action:function(){return t.restartSession()},variant:"info",category:"primary",text:Object(o.a)("Restart Terminal")}:{action:function(){return t.stopSession()},variant:"danger",category:"secondary",text:Object(o.a)("Stop Terminal")}}}),methods:g({},Object(i.c)("terminal",["restartSession","stopSession"]))},y=Object(f.a)(v,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.session?n("div",{staticClass:"ide-terminal d-flex flex-column"},[n("header",{staticClass:"ide-job-header d-flex align-items-center"},[n("h5",[t._v(t._s(t.__("Web Terminal")))]),t._v(" "),n("div",{staticClass:"ml-auto align-self-center"},[t.actionButton?n("gl-button",{attrs:{variant:t.actionButton.variant,category:t.actionButton.category},on:{click:t.actionButton.action}},[t._v(t._s(t.actionButton.text))]):t._e()],1)]),t._v(" "),n("terminal",{attrs:{"terminal-path":t.session.terminalPath,status:t.session.status}})],1):t._e()}),[],!1,null,null,null);e.default=y.exports},U0k0:function(t,e,n){"use strict";n.d(e,"a",(function(){return m}));var r=n("h7kv"),i=n.n(r),o=n("EmJ/"),s=n.n(o),l=n("6ObV"),a=n("FTOh"),c=n("khuk"),u=n("1OWu"),f=n("/lV4");function h(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function p(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const d=5;l.Terminal.applyAddon(a),l.Terminal.applyAddon(c);class m{constructor(t){var e=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.options=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?h(Object(n),!0).forEach((function(e){p(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({cursorBlink:!0,screenKeys:!0},n),this.container=t,this.onDispose=[],this.setSocketUrl(),this.createTerminal(),s()(window).off("resize.terminal").on("resize.terminal",(function(){e.terminal.fit()}))}setSocketUrl(){const{protocol:t,hostname:e,port:n}=window.location,r="https:"===t?"wss://":"ws://",i=this.container.dataset.projectPath;this.socketUrl="".concat(r).concat(e,":").concat(n).concat(i)}createTerminal(){var t=this;this.terminal=new l.Terminal(this.options),this.socket=new WebSocket(this.socketUrl,["terminal.gitlab.com"]),this.socket.binaryType="arraybuffer",this.terminal.open(this.container),this.terminal.fit(),this.terminal.webLinksInit(),this.terminal.focus(),this.socket.onopen=function(){t.runTerminal()},this.socket.onerror=function(){t.handleSocketFailure()}}runTerminal(){var t=this;const e=new TextDecoder("utf-8"),n=new TextEncoder("utf-8");this.terminal.on("data",(function(e){t.socket.send(n.encode(e))})),this.socket.addEventListener("message",(function(n){t.terminal.write(e.decode(n.data))})),this.isTerminalInitialized=!0,this.terminal.fit()}handleSocketFailure(){this.terminal.write("\r\n"),this.terminal.write(Object(f.a)("Connection failure"))}addScrollListener(t){const e=this.container.querySelector(".xterm-viewport"),n=i()((function(){t({canScrollUp:Object(u.c)(e,d),canScrollDown:Object(u.b)(e,d)})}));this.onDispose.push((function(){return e.removeEventListener("scroll",n)})),e.addEventListener("scroll",n),n({target:e})}disable(){this.terminal.setOption("cursorBlink",!1),this.terminal.setOption("theme",{foreground:"#707070"}),this.terminal.setOption("disableStdin",!0),this.socket.close()}dispose(){this.terminal.off("data"),this.terminal.dispose(),this.socket.close(),this.onDispose.forEach((function(t){return t()})),this.onDispose.length=0}scrollToTop(){this.terminal.scrollToTop()}scrollToBottom(){this.terminal.scrollToBottom()}fit(){this.terminal.fit()}}}}]);
//# sourceMappingURL=ide_terminal.6be873a6.chunk.js.map