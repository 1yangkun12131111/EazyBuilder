(this.webpackJsonp=this.webpackJsonp||[]).push([[305],{134:function(t,e,n){n("HVBj"),n("gjpc"),t.exports=n("1pcB")},"1pcB":function(t,e,n){"use strict";n.r(e);var o=n("jB52"),a=n("GiFX"),i=n("5v28"),r=n("NmEs"),l=n("0KyK"),s=n("Lzak"),c=n("4lAS"),p=n("sF+2"),d=n("pbPB"),m=n("XqDB"),u=n("XRO8"),v=n("/lV4"),g=n("kJRM"),h=n("aCCI"),f=n("bacz"),b=n("G3fq"),y=n.n(b),_=n("1cpz"),E={name:"ConfirmRollbackModal",components:{GlModal:_.a},props:{environment:{type:Object,required:!0}},computed:{modalTitle(){const t=this.environment.isLastDeployment?Object(v.e)("Environments|Re-deploy environment %{name}?"):Object(v.e)("Environments|Rollback environment %{name}?");return Object(v.f)(t,{name:y()(this.environment.name)})},commitShortSha(){const{last_deployment:t}=this.environment;return this.commitData(t,"short_id")},commitUrl(){const{last_deployment:t}=this.environment;return this.commitData(t,"commit_path")},commitTitle(){const{last_deployment:t}=this.environment;return this.commitData(t,"title")},modalText(){const t='<a class="commit-sha mr-0" href="'.concat(y()(this.commitUrl),'">'),e=y()(this.commitShortSha),n=y()(this.name),o=this.environment.isLastDeployment?Object(v.e)("Environments|This action will relaunch the job for commit %{linkStart}%{commitId}%{linkEnd}, putting the environment in a previous version. Are you sure you want to continue?"):Object(v.e)("Environments|This action will run the job defined by %{name} for commit %{linkStart}%{commitId}%{linkEnd} putting the environment in a previous version. You can revert it by re-deploying the latest version of your application. Are you sure you want to continue?");return Object(v.f)(o,{commitId:e,linkStart:t,linkEnd:"</a>",name:n},!1)},modalActionText(){return this.environment.isLastDeployment?Object(v.e)("Environments|Re-deploy"):Object(v.e)("Environments|Rollback")}},methods:{onOk(){g.a.$emit("rollbackEnvironment",this.environment)},commitData:(t,e)=>t&&t.commit?t.commit[e]:""}},w=n("tBpV"),C=Object(w.a)(E,(function(){var t=this.$createElement,e=this._self._c||t;return e("gl-modal",{attrs:{title:this.modalTitle,"modal-id":"confirm-rollback-modal","ok-title":this.modalActionText,"ok-variant":"danger"},on:{ok:this.onOk}},[e("p",{domProps:{innerHTML:this._s(this.modalText)}})])}),[],!1,null,null,null).exports,k=n("py3j"),S={name:"EnvironmentsEmptyState",props:{helpPath:{type:String,required:!0}}},x=Object(w.a)(S,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"empty-state"},[n("div",{staticClass:"text-content"},[n("h4",{staticClass:"blank-state-title js-blank-state-title"},[t._v("\n      "+t._s(t.s__("Environments|You don't have any environments right now"))+"\n    ")]),t._v(" "),n("p",{staticClass:"blank-state-text"},[t._v("\n      "+t._s(t.s__("Environments|Environments are places where\n      code gets deployed, such as staging or production."))+"\n      "),n("a",{attrs:{href:t.helpPath}},[t._v(" "+t._s(t.s__("Environments|More information"))+" ")])])])])}),[],!1,null,null,null).exports,j=n("MV2A"),P=n("30su"),O=n("Agcx"),$={components:{GlLink:j.a,GlModal:_.a,GlSprintf:P.a,ModalCopyButton:O.a},inject:["defaultBranchName"],props:{modalId:{type:String,required:!0}},instructionText:{step1:Object(v.e)("EnableReviewApp|%{stepStart}Step 1%{stepEnd}. Ensure you have Kubernetes set up and have a base domain for your %{linkStart}cluster%{linkEnd}."),step2:Object(v.e)("EnableReviewApp|%{stepStart}Step 2%{stepEnd}. Copy the following snippet:"),step3:Object(v.e)("EnableReviewApp|%{stepStart}Step 3%{stepEnd}. Add it to the project %{linkStart}gitlab-ci.yml%{linkEnd} file.")},modalInfo:{closeText:Object(v.e)("EnableReviewApp|Close"),copyToClipboardText:Object(v.e)("EnableReviewApp|Copy snippet text"),title:Object(v.e)("ReviewApp|Enable Review App")},computed:{modalInfoCopyStr(){return'deploy_review:\n  stage: deploy\n  script:\n    - echo "Deploy a review app"\n  environment:\n    name: review/$CI_COMMIT_REF_NAME\n    url: https://$CI_ENVIRONMENT_SLUG.example.com\n  only:\n    - branches\n  except:\n    - '.concat(this.defaultBranchName)}}},B=Object(w.a)($,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("gl-modal",{attrs:{"modal-id":t.modalId,title:t.$options.modalInfo.title,size:"lg","ok-only":"","ok-variant":"light","ok-title":t.$options.modalInfo.closeText}},[n("p",[n("gl-sprintf",{attrs:{message:t.$options.instructionText.step1},scopedSlots:t._u([{key:"step",fn:function(e){var o=e.content;return[n("strong",[t._v(t._s(o))])]}},{key:"link",fn:function(e){var o=e.content;return[n("gl-link",{attrs:{href:"https://docs.gitlab.com/ee/user/project/clusters/add_remove_clusters.html",target:"_blank"}},[t._v(t._s(o))])]}}])})],1),t._v(" "),n("div",[n("p",[n("gl-sprintf",{attrs:{message:t.$options.instructionText.step2},scopedSlots:t._u([{key:"step",fn:function(e){var o=e.content;return[n("strong",[t._v(t._s(o))])]}}])})],1),t._v(" "),n("div",{staticClass:"gl-display-flex align-items-start"},[n("pre",{staticClass:"gl-w-full",attrs:{"data-testid":"enable-review-app-copy-string"}},[t._v(t._s(t.modalInfoCopyStr)+" ")]),t._v(" "),n("modal-copy-button",{attrs:{title:t.$options.modalInfo.copyToClipboardText,text:t.$options.modalInfo.copyString,"modal-id":t.modalId,"css-classes":"border-0"}})],1)]),t._v(" "),n("p",[n("gl-sprintf",{attrs:{message:t.$options.instructionText.step3},scopedSlots:t._u([{key:"step",fn:function(e){var o=e.content;return[n("strong",[t._v(t._s(o))])]}},{key:"link",fn:function(e){var o=e.content;return[n("gl-link",{attrs:{href:"blob/"+t.defaultBranchName+"/.gitlab-ci.yml",target:"_blank"}},[t._v(t._s(o))])]}}])})],1)])}),[],!1,null,null,null).exports,I=n("Fpys"),T={i18n:{newEnvironmentButtonLabel:Object(v.e)("Environments|New environment"),reviewAppButtonLabel:Object(v.e)("Environments|Enable review app")},modal:{id:"enable-review-app-info"},components:{ConfirmRollbackModal:C,emptyState:x,EnableReviewAppModal:B,GlBadge:s.a,GlButton:c.a,GlTab:p.a,GlTabs:d.a,StopEnvironmentModal:I.a,DeleteEnvironmentModal:k.a},directives:{"gl-modal":m.a},mixins:[f.a,h.a],props:{endpoint:{type:String,required:!0},canCreateEnvironment:{type:Boolean,required:!0},canReadEnvironment:{type:Boolean,required:!0},newEnvironmentPath:{type:String,required:!0},helpPagePath:{type:String,required:!0}},created(){g.a.$on("toggleFolder",this.toggleFolder),g.a.$on("toggleDeployBoard",this.toggleDeployBoard)},beforeDestroy(){g.a.$off("toggleFolder"),g.a.$off("toggleDeployBoard")},methods:{toggleDeployBoard(t){this.store.toggleDeployBoard(t.id)},toggleFolder(t){this.store.toggleFolder(t),t.isOpen||this.fetchChildEnvironments(t,!0)},fetchChildEnvironments(t){var e=this;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.store.updateEnvironmentProp(t,"isLoadingFolderContent",n),this.service.getFolderContent(t.folder_path,t.state).then((function(n){return e.store.setfolderContent(t,n.data.environments)})).then((function(){return e.store.updateEnvironmentProp(t,"isLoadingFolderContent",!1)})).catch((function(){Object(u.c)(Object(v.e)("Environments|An error occurred while fetching the environments.")),e.store.updateEnvironmentProp(t,"isLoadingFolderContent",!1)}))},successCallback(t){var e=this;this.saveData(t);const n=this.store.getOpenFolders();n.length&&n.forEach((function(t){return e.fetchChildEnvironments(t)}))}}},A=Object(w.a)(T,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"environments-section"},[n("stop-environment-modal",{attrs:{environment:t.environmentInStopModal}}),t._v(" "),n("delete-environment-modal",{attrs:{environment:t.environmentInDeleteModal}}),t._v(" "),n("confirm-rollback-modal",{attrs:{environment:t.environmentInRollbackModal}}),t._v(" "),n("div",{staticClass:"gl-w-full"},[n("div",{staticClass:"gl-display-flex gl-flex-direction-column gl-mt-3 gl-md-display-none!"},[t.state.reviewAppDetails.can_setup_review_app?n("gl-button",{directives:[{name:"gl-modal",rawName:"v-gl-modal",value:t.$options.modal.id,expression:"$options.modal.id"}],staticClass:"gl-mb-3 gl-flex-fill-1",attrs:{"data-testid":"enable-review-app",variant:"info",category:"secondary",type:"button"}},[t._v(t._s(t.$options.i18n.reviewAppButtonLabel))]):t._e(),t._v(" "),t.canCreateEnvironment?n("gl-button",{attrs:{href:t.newEnvironmentPath,"data-testid":"new-environment",category:"primary",variant:"confirm"}},[t._v(t._s(t.$options.i18n.newEnvironmentButtonLabel))]):t._e()],1),t._v(" "),n("gl-tabs",{attrs:{"content-class":"gl-display-none"},scopedSlots:t._u([{key:"tabs-end",fn:function(){return[n("div",{staticClass:"gl-display-none gl-md-display-flex gl-lg-align-items-center gl-lg-flex-direction-row gl-lg-flex-fill-1 gl-lg-justify-content-end gl-lg-mt-0"},[t.state.reviewAppDetails.can_setup_review_app?n("gl-button",{directives:[{name:"gl-modal",rawName:"v-gl-modal",value:t.$options.modal.id,expression:"$options.modal.id"}],staticClass:"gl-mb-3 gl-lg-mr-3 gl-lg-mb-0",attrs:{"data-testid":"enable-review-app",variant:"info",category:"secondary",type:"button"}},[t._v(t._s(t.$options.i18n.reviewAppButtonLabel))]):t._e(),t._v(" "),t.canCreateEnvironment?n("gl-button",{attrs:{href:t.newEnvironmentPath,"data-testid":"new-environment",category:"primary",variant:"confirm"}},[t._v(t._s(t.$options.i18n.newEnvironmentButtonLabel))]):t._e()],1)]},proxy:!0}])},t._l(t.tabs,(function(e,o){return n("gl-tab",{key:o,attrs:{"title-item-class":"js-environments-tab-"+e.scope},on:{click:function(n){return t.onChangeTab(e.scope)}},scopedSlots:t._u([{key:"title",fn:function(){return[n("span",[t._v(t._s(e.name))]),t._v(" "),n("gl-badge",{staticClass:"gl-tab-counter-badge",attrs:{size:"sm"}},[t._v(t._s(e.count))])]},proxy:!0}],null,!0)})})),1),t._v(" "),n("container",{attrs:{"is-loading":t.isLoading,environments:t.state.environments,pagination:t.state.paginationInformation,"can-read-environment":t.canReadEnvironment},on:{onChangePage:t.onChangePage},scopedSlots:t._u([t.isLoading||0!==t.state.environments.length?null:{key:"empty-state",fn:function(){return[n("empty-state",{attrs:{"help-path":t.helpPagePath}})]},proxy:!0}],null,!0)}),t._v(" "),t.state.reviewAppDetails.can_setup_review_app?n("enable-review-app-modal",{attrs:{"modal-id":t.$options.modal.id,"data-testid":"enable-review-app-modal"}}):t._e()],1)],1)}),[],!1,null,null,null).exports;o.default.use(l.a),o.default.use(a.default);const R=new a.default({defaultClient:Object(i.default)()});!function(){const t=document.getElementById("environments-list-view");new o.default({el:t,components:{environmentsComponent:A},apolloProvider:R,provide:{projectPath:t.dataset.projectPath,defaultBranchName:t.dataset.defaultBranchName},data(){const e=t.dataset;return{endpoint:e.environmentsDataEndpoint,newEnvironmentPath:e.newEnvironmentPath,helpPagePath:e.helpPagePath,canCreateEnvironment:Object(r.K)(e.canCreateEnvironment),canReadEnvironment:Object(r.K)(e.canReadEnvironment)}},render(t){return t("environments-component",{props:{endpoint:this.endpoint,newEnvironmentPath:this.newEnvironmentPath,helpPagePath:this.helpPagePath,canCreateEnvironment:this.canCreateEnvironment,canReadEnvironment:this.canReadEnvironment}})}})}()},Agcx:function(t,e,n){"use strict";var o=n("o4PY"),a=n.n(o),i=n("4lAS"),r=n("LLbv"),l=n("Y98u"),s=n.n(l),c=n("GuZl"),p={components:{GlButton:i.a},directives:{GlTooltip:r.a},props:{text:{type:String,required:!1,default:""},id:{type:String,required:!1,default:function(){return a()("modal-copy-button-")}},container:{type:String,required:!1,default:""},cssClasses:{type:String,required:!1,default:""},modalId:{type:String,required:!1,default:""},target:{type:String,required:!1,default:""},title:{type:String,required:!0},tooltipPlacement:{type:String,required:!1,default:"top"},tooltipContainer:{type:String,required:!1,default:null},category:{type:String,required:!1,default:"primary"}},computed:{modalDomId(){return this.modalId?"#".concat(this.modalId):""}},mounted(){var t=this;this.$nextTick((function(){t.clipboard=new s.a(t.$el,{container:document.querySelector("".concat(t.modalDomId," div.modal-content"))||document.getElementById(t.container)||document.body}),t.clipboard.on("success",(function(e){t.$root.$emit(c.b,t.id),t.$emit("success",e),e.clearSelection(),e.trigger.blur()})).on("error",(function(e){return t.$emit("error",e)}))}))},destroyed(){this.clipboard&&this.clipboard.destroy()}},d=n("tBpV"),m=Object(d.a)(p,(function(){var t=this,e=t.$createElement;return(t._self._c||e)("gl-button",{directives:[{name:"gl-tooltip",rawName:"v-gl-tooltip",value:{placement:t.tooltipPlacement,container:t.tooltipContainer},expression:"{ placement: tooltipPlacement, container: tooltipContainer }"}],class:t.cssClasses,attrs:{id:t.id,"data-clipboard-target":t.target,"data-clipboard-text":t.text,title:t.title,"aria-label":t.title,category:t.category,icon:"copy-to-clipboard"}})}),[],!1,null,null,null);e.a=m.exports}},[[134,1,0,6,2,3,4,5,24,37,49,93,114]]]);
//# sourceMappingURL=pages.projects.environments.index.01261e5c.chunk.js.map