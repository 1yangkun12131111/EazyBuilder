(this.webpackJsonp=this.webpackJsonp||[]).push([[464,143],{"04gX":function(e,t,r){"use strict";r.r(t);var n={};r.r(n),r.d(n,"setInitialData",(function(){return p})),r.d(n,"fetchAwards",(function(){return f})),r.d(n,"toggleAward",(function(){return g}));var a=r("jB52"),o=r("yi8e"),i=r("NmEs"),s=r("NbhA"),c=(r("jaBk"),r("cT/n")),l=r("2ibD"),u=r("/lV4"),d=r("udiD");const p=function(e,t){let{commit:r}=e;return r("SET_INITIAL_DATA",t)},f=async function(e){let{commit:t,dispatch:r,state:n}=e,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"1";try{const{data:e,headers:o}=await l.a.get(n.path,{params:{per_page:100,page:a}}),s=Object(i.I)(o)["X-NEXT-PAGE"];t("FETCH_AWARDS_SUCCESS",e),s&&r("fetchAwards",s)}catch(e){c.a(e)}},g=async function(e,t){let{commit:r,state:n}=e;const a=n.awards.find((function(e){return e.name===t&&e.user.id===n.currentUserId}));try{if(a)await l.a.delete("".concat(n.path,"/").concat(a.id)),r("REMOVE_AWARD",a.id),Object(d.a)(Object(u.a)("Award removed"));else{const{data:e}=await l.a.post(n.path,{name:t});r("ADD_NEW_AWARD",e),Object(d.a)(Object(u.a)("Award added"))}}catch(e){c.a(e)}};r("orcL");var h={SET_INITIAL_DATA(e,t){let{path:r,currentUserId:n,canAwardEmoji:a}=t;e.path=r,e.currentUserId=n,e.canAwardEmoji=a},FETCH_AWARDS_SUCCESS(e,t){e.awards.push(...t)},ADD_NEW_AWARD(e,t){e.awards.push(t)},REMOVE_AWARD(e,t){e.awards=e.awards.filter((function(e){let{id:r}=e;return r!==t}))}};a.default.use(o.b);function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach((function(t){y(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function y(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}t.default=function(e){const{dataset:{path:t}}=e,r=Object(i.K)(e.dataset.canAwardEmoji);return new a.default({el:e,store:new o.b.Store({state:{awards:[],awardPath:"",currentUserId:null,canAwardEmoji:!1},actions:n,mutations:h}),computed:b({},Object(o.f)(["currentUserId","canAwardEmoji","awards"])),created(){this.setInitialData({path:t,currentUserId:window.gon.current_user_id,canAwardEmoji:r})},mounted(){this.fetchAwards()},methods:b({},Object(o.c)(["setInitialData","fetchAwards","toggleAward"])),render(e){return e(s.a,{props:{awards:this.awards,canAwardEmoji:this.canAwardEmoji,currentUserId:this.currentUserId,defaultAwards:["thumbsup","thumbsdown"],selectedClass:"gl-bg-blue-50! is-active"},on:{award:this.toggleAward}})}})}},NbhA:function(e,t,r){"use strict";r("EWC9"),r("orcL");var n=r("Bk2k"),a=r.n(n),o=r("4lAS"),i=r("s1D3"),s=r("LLbv"),c=r("YH60"),l=r("/lV4"),u=r("sHIo"),d=r("tDP3");function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(Object(r),!0).forEach((function(t){g(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function g(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function h(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var m={components:{GlButton:o.a,GlIcon:i.a,EmojiPicker:c.default},directives:{GlTooltip:s.a},mixins:[Object(u.a)()],props:{awards:{type:Array,required:!0},canAwardEmoji:{type:Boolean,required:!0},currentUserId:{type:Number,required:!1,default:-1},addButtonClass:{type:String,required:!1,default:""},defaultAwards:{type:Array,required:!1,default:function(){return[]}},selectedClass:{type:String,required:!1,default:"selected"}},data:()=>({isMenuOpen:!1}),computed:{groupedDefaultAwards(){return this.defaultAwards.reduce((function(e,t){return Object.assign(e,{[t]:[]})}),{})},groupedAwards(){var e=this;const t=f(f({},this.groupedDefaultAwards),a()(this.awards,(function(e){return e.name}))),{thumbsup:r,thumbsdown:n}=t,o=h(t,["thumbsup","thumbsdown"]);return[...r?[this.createAwardList("thumbsup",r)]:[],...n?[this.createAwardList("thumbsdown",n)]:[],...Object.entries(o).map((function(t){let[r,n]=t;return e.createAwardList(r,n)}))]},isAuthoredByMe(){return this.noteAuthorId===this.currentUserId}},methods:{getAwardClassBindings(e){return{[this.selectedClass]:this.hasReactionByCurrentUser(e),disabled:-1===this.currentUserId}},hasReactionByCurrentUser(e){var t=this;return-1!==this.currentUserId&&e.some((function(e){return e.user.id===t.currentUserId}))},createAwardList(e,t){return{name:e,list:t,title:this.getAwardListTitle(t),classes:this.getAwardClassBindings(t),html:Object(d.glEmojiTag)(e)}},getAwardListTitle(e){var t=this;if(!e.length)return"";const r=this.hasReactionByCurrentUser(e),n=r?9:10;let a=e;r&&(a=a.filter((function(e){return e.user.id!==t.currentUserId})));const o=a.slice(0,n).map((function(e){return e.user.name})),i=a.slice(n,a.length);r&&o.unshift(Object(l.a)("You"));let s="";return i.length?s=Object(l.f)(Object(l.a)("%{listToShow}, and %{awardsListLength} more."),{listToShow:o.join(", "),awardsListLength:i.length},!1):o.length>1?(s=o.slice(0,o.length-1).join(", "),s+=o.length>2?",":"",s+=Object(l.f)(Object(l.a)(" and %{sliced}"),{sliced:o.slice(-1)},!1)):s=o.join(Object(l.a)(" and ")),s},handleAward(e){if(!this.canAwardEmoji)return;const t=/^[0-9]+$/.test(e)?Number(e):e;this.$emit("award",t),document.activeElement&&document.activeElement.blur()},setIsMenuOpen(e){this.isMenuOpen=e}}},b=r("tBpV"),y=Object(b.a)(m,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"awards js-awards-block"},[e._l(e.groupedAwards,(function(t){return r("gl-button",{directives:[{name:"gl-tooltip",rawName:"v-gl-tooltip.viewport",modifiers:{viewport:!0}}],key:t.name,staticClass:"gl-mr-3",class:t.classes,attrs:{title:t.title,"data-testid":"award-button"},on:{click:function(r){return e.handleAward(t.name)}},scopedSlots:e._u([{key:"emoji",fn:function(){return[r("span",{staticClass:"award-emoji-block",attrs:{"data-testid":"award-html"},domProps:{innerHTML:e._s(t.html)}})]},proxy:!0}],null,!0)},[e._v(" "),r("span",{staticClass:"js-counter"},[e._v(e._s(t.list.length))])])})),e._v(" "),e.canAwardEmoji?r("div",{staticClass:"award-menu-holder"},[e.glFeatures.improvedEmojiPicker?r("emoji-picker",{attrs:{"toggle-class":["add-reaction-button gl-relative!",{"is-active":e.isMenuOpen}]},on:{click:e.handleAward,shown:function(t){return e.setIsMenuOpen(!0)},hidden:function(t){return e.setIsMenuOpen(!1)}},scopedSlots:e._u([{key:"button-content",fn:function(){return[r("span",{staticClass:"reaction-control-icon reaction-control-icon-neutral"},[r("gl-icon",{attrs:{name:"slight-smile"}})],1),e._v(" "),r("span",{staticClass:"reaction-control-icon reaction-control-icon-positive"},[r("gl-icon",{attrs:{name:"smiley"}})],1),e._v(" "),r("span",{staticClass:"reaction-control-icon reaction-control-icon-super-positive"},[r("gl-icon",{attrs:{name:"smile"}})],1)]},proxy:!0}],null,!1,3506434543)}):r("gl-button",{directives:[{name:"gl-tooltip",rawName:"v-gl-tooltip.viewport",modifiers:{viewport:!0}}],staticClass:"add-reaction-button js-add-award",class:e.addButtonClass,attrs:{title:"Add reaction","aria-label":e.__("Add reaction")}},[r("span",{staticClass:"reaction-control-icon reaction-control-icon-neutral"},[r("gl-icon",{attrs:{name:"slight-smile"}})],1),e._v(" "),r("span",{staticClass:"reaction-control-icon reaction-control-icon-positive"},[r("gl-icon",{attrs:{name:"smiley"}})],1),e._v(" "),r("span",{staticClass:"reaction-control-icon reaction-control-icon-super-positive"},[r("gl-icon",{attrs:{name:"smile"}})],1)])],1):e._e()],2)}),[],!1,null,null,null);t.a=y.exports},YH60:function(e,t,r){"use strict";r.r(t);r("jaBk");var n=r("W7Ty"),a=r.n(n),o=r("s1D3"),i=r("Yyc1"),s=r("iN9h"),c=r("T9Fk"),l=r.n(c),u=r("tDP3"),d=r("5yoc"),p=r("ehHk"),f=r("0AwG"),g={props:{emojis:{type:Array,required:!0},renderGroup:{type:Boolean,required:!0},clickEmoji:{type:Function,required:!0}}},h=r("tBpV"),m=Object(h.a)(g,(function(e,t){var r=t._c;return r("div",{staticClass:"gl-display-flex gl-flex-wrap gl-mb-2"},[t.props.renderGroup?t._l(t.props.emojis,(function(e){return r("button",{key:e,staticClass:"gl-border-0 gl-bg-transparent gl-px-0 gl-py-2 gl-text-center emoji-picker-emoji",attrs:{type:"button","data-testid":"emoji-button"},on:{click:function(r){return t.props.clickEmoji(e)}}},[r("gl-emoji",{attrs:{"data-name":e}})],1)})):t._e()],2)}),[],!0,null,null,null).exports,b={components:{GlIntersectionObserver:p.a,EmojiGroup:m},props:{category:{type:String,required:!0},emojis:{type:Array,required:!0}},data:()=>({renderGroup:!1}),computed:{categoryTitle(){return Object(f.l)(this.category)}},methods:{categoryAppeared(){this.renderGroup=!0,this.$emit("appear",this.category)}}},y=Object(h.a)(b,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("gl-intersection-observer",{staticClass:"gl-px-5 gl-h-full",on:{appear:e.categoryAppeared}},[r("div",{staticClass:"gl-top-0 gl-py-3 gl-w-full gl-z-index-1 emoji-picker-category-header"},[r("b",[e._v(e._s(e.categoryTitle))])]),e._v(" "),e.emojis.length?e._l(e.emojis,(function(t,n){return r("emoji-group",{key:n,attrs:{emojis:t,"render-group":e.renderGroup,"click-emoji":function(t){return e.$emit("click",t)}}})})):r("p",[e._v("\n    "+e._s(e.s__("AwardEmoji|No emojis found."))+"\n  ")])],2)}),[],!1,null,null,null).exports,j=r("Am3t"),w=r.n(j),O=(r("pBsb"),r("d+lS")),v=r.n(O),A=r("htNe"),_=r.n(A),E=r("06tH"),C=r.n(E);function S(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function k(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?S(Object(r),!0).forEach((function(t){P(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function P(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const D=function(e){return e*d.d+d.b},I=function(){const e=C.a.get(d.e);if(!e)return null;const t=w()(v()(e.split(",")),9);return{frequently_used:{emojis:t,top:0,height:D(t.length)}}},x=_()((async function(){await Object(u.initEmojiMap)();const e=await Object(u.getEmojiCategoryMap)(),t=I();let r=t?t.frequently_used.top+t.frequently_used.height:0;return Object.freeze(Object.keys(e).filter((function(e){return e!==d.f})).reduce((function(t,n){const a=w()(e[n],d.c),o=D(a.length),i=k(k({},t),{},{[n]:{emojis:a,height:o,top:r}});return r+=o,i}),t||{}))}));var T={props:{searchValue:{type:String,required:!0}},data:()=>({render:!1}),computed:{filteredCategories(){if(""!==this.searchValue){const e=w()(Object(u.searchEmoji)(this.searchValue).map((function(e){let{emoji:t}=e;return t.name})),d.c);return{search:{emojis:e,height:D(e.length)}}}return this.categories}},async mounted(){this.categories=await x(),this.render=!0}},B=Object(h.a)(T,(function(){var e=this.$createElement,t=this._self._c||e;return this.render?t("div",[this._t("default",null,{filteredCategories:this.filteredCategories})],2):this._e()}),[],!1,null,null,null).exports,L={components:{GlIcon:o.a,GlDropdown:i.a,GlSearchBoxByType:s.a,VirtualList:l.a,Category:y,EmojiList:B},props:{toggleClass:{type:[Array,String,Object],required:!1,default:function(){return[]}}},data:()=>({currentCategory:0,searchValue:""}),computed:{categoryNames:()=>u.CATEGORY_NAMES.filter((function(e){return e!==d.f||null!==I()})).map((function(e){return{name:e,icon:d.a[e]}}))},methods:{categoryAppeared(e){this.currentCategory=e},async scrollToCategory(e){const t=await x(),{top:r}=t[e];this.$refs.virtualScoller.setScrollTop(r)},selectEmoji(e){this.$emit("click",e),this.$refs.dropdown.hide(),function(e){const t=v()((C.a.get(d.e)||"").split(",").filter((function(e){return e})).concat(e));C.a.set(d.e,t.join(","),{expires:365})}(e)},getBoundaryElement:()=>document.querySelector(".content-wrapper")||"scrollParent",onSearchInput(){this.$refs.virtualScoller.setScrollTop(0),this.$refs.virtualScoller.forceRender()},async onScroll(e,t){let{offset:r}=t;const n=await x();this.currentCategory=a()(Object.values(n),(function(e){let{top:t}=e;return r>=t}))}}},N=Object(h.a)(L,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"emoji-picker"},[r("gl-dropdown",{ref:"dropdown",attrs:{"toggle-class":e.toggleClass,boundary:e.getBoundaryElement(),"menu-class":"dropdown-extended-height",category:"tertiary","no-flip":"",right:"",lazy:""},on:{shown:function(t){return e.$emit("shown")},hidden:function(t){return e.$emit("hidden")}},scopedSlots:e._u([{key:"button-content",fn:function(){return[e._t("button-content")]},proxy:!0}],null,!0)},[e._v(" "),r("gl-search-box-by-type",{staticClass:"gl-mx-5! gl-mb-2!",attrs:{autofocus:"",debounce:"500"},on:{input:e.onSearchInput},model:{value:e.searchValue,callback:function(t){e.searchValue=t},expression:"searchValue"}}),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:!e.searchValue,expression:"!searchValue"}],staticClass:"gl-display-flex gl-mx-5 gl-border-b-solid gl-border-gray-100 gl-border-b-1"},e._l(e.categoryNames,(function(t,n){return r("button",{key:t.name,staticClass:"gl-border-0 gl-border-b-2 gl-border-b-solid gl-flex-fill-1 gl-text-gray-300 gl-pt-3 gl-pb-3 gl-bg-transparent emoji-picker-category-tab",class:{"gl-text-body! emoji-picker-category-active":n===e.currentCategory},attrs:{type:"button","aria-label":t.name},on:{click:function(r){return e.scrollToCategory(t.name)}}},[r("gl-icon",{attrs:{name:t.icon,size:12}})],1)})),0),e._v(" "),r("emoji-list",{attrs:{"search-value":e.searchValue},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.filteredCategories;return[r("virtual-list",{ref:"virtualScoller",attrs:{size:258,remain:1,bench:2,variable:"",onscroll:e.onScroll}},e._l(n,(function(t,n){return r("div",{key:n,style:{height:t.height+"px"}},[r("category",{attrs:{category:n,emojis:t.emojis},on:{click:e.selectEmoji}})],1)})),0)]}}])})],1)],1)}),[],!1,null,null,null);t.default=N.exports}}]);
//# sourceMappingURL=464.69042ea0.chunk.js.map