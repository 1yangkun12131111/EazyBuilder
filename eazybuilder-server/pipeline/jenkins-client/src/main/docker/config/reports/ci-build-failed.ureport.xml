<?xml version="1.0" encoding="UTF-8"?><ureport><cell expand="None" name="A1" row="1" col="1"><cell-style font-size="12" forecolor="0,0,0" font-family="宋体" bgcolor="91,192,222" align="center" valign="middle"><left-border width="1" style="solid" color="0,0,0"/><right-border width="1" style="solid" color="0,0,0"/><top-border width="1" style="solid" color="0,0,0"/><bottom-border width="1" style="solid" color="0,0,0"/></cell-style><simple-value><![CDATA[项目名称]]></simple-value></cell><cell expand="None" name="B1" row="1" col="2"><cell-style font-size="12" forecolor="0,0,0" font-family="宋体" bgcolor="91,192,222" align="center" valign="middle"><left-border width="1" style="solid" color="0,0,0"/><right-border width="1" style="solid" color="0,0,0"/><top-border width="1" style="solid" color="0,0,0"/><bottom-border width="1" style="solid" color="0,0,0"/></cell-style><simple-value><![CDATA[工程]]></simple-value></cell><cell expand="None" name="C1" row="1" col="3"><cell-style font-size="12" forecolor="0,0,0" font-family="宋体" bgcolor="91,192,222" align="center" valign="middle"><left-border width="1" style="solid" color="0,0,0"/><right-border width="1" style="solid" color="0,0,0"/><top-border width="1" style="solid" color="0,0,0"/><bottom-border width="1" style="solid" color="0,0,0"/></cell-style><simple-value><![CDATA[流水线失败阶段]]></simple-value></cell><cell expand="None" name="D1" row="1" col="4"><cell-style font-size="12" forecolor="0,0,0" font-family="宋体" bgcolor="91,192,222" align="center" valign="middle"><left-border width="1" style="solid" color="0,0,0"/><right-border width="1" style="solid" color="0,0,0"/><top-border width="1" style="solid" color="0,0,0"/><bottom-border width="1" style="solid" color="0,0,0"/></cell-style><simple-value><![CDATA[失败原因]]></simple-value></cell><cell expand="None" name="E1" row="1" col="5"><cell-style font-size="12" forecolor="0,0,0" font-family="宋体" bgcolor="91,192,222" align="center" valign="middle"><left-border width="1" style="solid" color="0,0,0"/><right-border width="1" style="solid" color="0,0,0"/><top-border width="1" style="solid" color="0,0,0"/><bottom-border width="1" style="solid" color="0,0,0"/></cell-style><simple-value><![CDATA[处理建议]]></simple-value></cell><cell expand="None" name="F1" row="1" col="6"><cell-style font-size="12" forecolor="0,0,0" font-family="宋体" bgcolor="91,192,222" align="center" valign="middle"><left-border width="1" style="solid" color="0,0,0"/><right-border width="1" style="solid" color="0,0,0"/><top-border width="1" style="solid" color="0,0,0"/><bottom-border width="1" style="solid" color="0,0,0"/></cell-style><simple-value><![CDATA[最新构建时间]]></simple-value></cell><cell expand="Down" name="A2" row="2" col="1"><cell-style font-size="10" forecolor="0,0,0" font-family="宋体" align="center" valign="middle"><left-border width="1" style="solid" color="0,0,0"/><right-border width="1" style="solid" color="0,0,0"/><top-border width="1" style="solid" color="0,0,0"/><bottom-border width="1" style="solid" color="0,0,0"/></cell-style><dataset-value dataset-name="failed" aggregate="group" property="项目" order="none" mapping-type="simple"></dataset-value></cell><cell expand="Down" name="B2" row="2" col="2"><cell-style font-size="10" forecolor="0,0,0" font-family="宋体" align="center" valign="middle"><left-border width="1" style="solid" color="0,0,0"/><right-border width="1" style="solid" color="0,0,0"/><top-border width="1" style="solid" color="0,0,0"/><bottom-border width="1" style="solid" color="0,0,0"/></cell-style><dataset-value dataset-name="failed" aggregate="group" property="工程" order="none" mapping-type="simple"></dataset-value></cell><cell expand="Down" name="C2" row="2" col="3"><cell-style font-size="10" forecolor="0,0,0" font-family="宋体" align="center" valign="middle"><left-border width="1" style="solid" color="0,0,0"/><right-border width="1" style="solid" color="0,0,0"/><top-border width="1" style="solid" color="0,0,0"/><bottom-border width="1" style="solid" color="0,0,0"/></cell-style><dataset-value dataset-name="failed" aggregate="group" property="流水线失败阶段" order="none" mapping-type="simple"></dataset-value></cell><cell expand="Down" name="D2" row="2" col="4"><cell-style font-size="10" forecolor="0,0,0" font-family="宋体" align="center" valign="middle"><left-border width="1" style="solid" color="0,0,0"/><right-border width="1" style="solid" color="0,0,0"/><top-border width="1" style="solid" color="0,0,0"/><bottom-border width="1" style="solid" color="0,0,0"/></cell-style><dataset-value dataset-name="failed" aggregate="group" property="失败原因" order="none" mapping-type="simple"></dataset-value></cell><cell expand="Down" name="E2" row="2" col="5"><cell-style font-size="10" forecolor="0,0,0" font-family="宋体" align="center" valign="middle"><left-border width="1" style="solid" color="0,0,0"/><right-border width="1" style="solid" color="0,0,0"/><top-border width="1" style="solid" color="0,0,0"/><bottom-border width="1" style="solid" color="0,0,0"/></cell-style><dataset-value dataset-name="failed" aggregate="group" property="处理建议" order="none" mapping-type="simple"></dataset-value></cell><cell expand="Down" name="F2" row="2" col="6"><cell-style font-size="10" forecolor="0,0,0" font-family="宋体" format="yyyy-MM-dd" align="center" valign="middle"><left-border width="1" style="solid" color="0,0,0"/><right-border width="1" style="solid" color="0,0,0"/><top-border width="1" style="solid" color="0,0,0"/><bottom-border width="1" style="solid" color="0,0,0"/></cell-style><dataset-value dataset-name="failed" aggregate="group" property="最新构建时间" order="none" mapping-type="simple"></dataset-value></cell><row row-number="1" height="18"/><row row-number="2" height="19"/><column col-number="1" width="170"/><column col-number="2" width="182"/><column col-number="3" width="116"/><column col-number="4" width="96"/><column col-number="5" width="263"/><column col-number="6" width="149"/><datasource name="136-ci-mysql" type="jdbc" username="useranme" password="password" url="jdbc:mysql://0.0.0.0:5500/ci?useUnicode=true&amp;characterEncoding=utf-8" driver="com.mysql.jdbc.Driver"><dataset name="ta" type="sql"><sql><![CDATA[SELECT
    t.code AS teamCode,
    t.name AS teamName,
      p.id as pid,
    p.name,
    p.description,
    ifnull(st.email,'N/A') as email,
    ifnull(st.user_name,'N/A') as user_name,
    ifnull(sum(st.additions),0) as totalAdd,
    ifnull(sum(st.deletions),0) as totalDel,
    ifnull(sum(st.pushed),0) as totalPush
FROM
    ci_project p
    inner join ci_team t on p.team_id = t.id
    inner join ci_scm s on p.scm_id = s.id
	left join ci_user_statistic st on s.url LIKE CONCAT('%',
            st.group_name,
            '/',
            st.project_name,
            '%')
WHERE 1=1
and st.day is null or (st.day >= :startDate and st.day <= :endDate)
group by teamCode,teamName,pid,name,description,st.email,st.user_name
ORDER BY teamCode , name ]]></sql><field name="teamCode"/><field name="teamName"/><field name="pid"/><field name="name"/><field name="description"/><field name="email"/><field name="user_name"/><field name="totalAdd"/><field name="totalDel"/><field name="totalPush"/><parameter name="startDate" type="String" default-value="2021-03-02"/><parameter name="endDate" type="String" default-value="2021-03-10"/></dataset><dataset name="pq" type="sql"><sql><![CDATA[SELECT 
    z.*,
    IF(z.code_line = 0, 'N/A', z.code_line) AS totalLine,
    u.name AS ownerName
FROM
    (SELECT 
        t.code AS teamCode,
            t.name AS teamName,
            t.owner_id AS ownerId,
            prj.id AS pid,
            prj.name AS projectName,
            prj.description AS projectDesc,
            totalBuild,
            totalSuccess,
            status AS latestStatus,
            FROM_UNIXTIME(latestBuildTime / 1000, '%Y-%m-%d %h:%i:%s') AS lastBuild,
            SUM(IF(m.type = 'code_line', m.val, 0)) AS code_line,
            SUM(IF(m.type = 'bug_blocker', m.val, 0)) AS bug_blocker,
            SUM(IF(m.type = 'bug_critical', m.val, 0)) AS bug_critical,
            SUM(IF(m.type = 'code_smell_blocker', m.val, 0)) AS code_smell_blocker,
            SUM(IF(m.type = 'code_smell_critical', m.val, 0)) AS code_smell_critical,
            SUM(IF(m.type = 'vulner_blocker', m.val, 0)) AS vulner_blocker,
            SUM(IF(m.type = 'vulner_critical', m.val, 0)) AS vulner_critical,
            SUM(IF(m.type = 'unit_test_success_rate', m.val, 0)) AS unit_test_success_rate,
            SUM(IF(m.type = 'unit_test_coverage_rate', m.val, 0)) AS unit_test_coverage_rate,
            SUM(IF(m.type = 'dc_high', m.val, 0)) AS dc_high,
            SUM(IF(m.type = 'dc_medium', m.val, 0)) AS dc_medium
    FROM
        ci_project prj
        
    LEFT JOIN (SELECT 
        MAX(a.id) AS mid, a.type AS metricType, b.project_id
    FROM
        ci_metric a, ci_pipeline_history b
    WHERE
        a.pipeline_id = b.id
    GROUP BY b.project_id , metricType) p ON p.project_id = prj.id
    
    LEFT JOIN (
    
    SELECT 
        h.status, aa.*
    FROM
        ci_pipeline_history h
    INNER JOIN (SELECT 
        project_id,
            MAX(start_time_millis) AS latestBuildTime,
            COUNT(*) AS totalBuild,
            SUM(IF(status = 2, 1, 0)) AS totalSuccess
    FROM
        ci_pipeline_history
    WHERE
        1 = 1
            AND start_time_millis >= UNIX_TIMESTAMP(:startDate) * 1000
            AND start_time_millis <= UNIX_TIMESTAMP(:endDate) * 1000
    GROUP BY project_id) aa ON h.start_time_millis = aa.latestBuildTime
        AND h.project_id = aa.project_id) a ON a.project_id = prj.id
    INNER JOIN ci_team t ON prj.team_id = t.id
    LEFT JOIN ci_metric m ON p.mid = m.id
    GROUP BY teamCode , teamName , ownerId , pid , projectName , projectDesc , totalBuild , totalSuccess , latestBuildTime , status
    ORDER BY teamCode , projectName) z
        INNER JOIN
    ci_user u ON ownerId = u.id]]></sql><field name="teamCode"/><field name="teamName"/><field name="ownerId"/><field name="pid"/><field name="projectName"/><field name="projectDesc"/><field name="totalBuild"/><field name="totalSuccess"/><field name="latestStatus"/><field name="lastBuild"/><field name="code_line"/><field name="bug_blocker"/><field name="bug_critical"/><field name="code_smell_blocker"/><field name="code_smell_critical"/><field name="vulner_blocker"/><field name="vulner_critical"/><field name="unit_test_success_rate"/><field name="unit_test_coverage_rate"/><field name="dc_high"/><field name="dc_medium"/><field name="totalLine"/><field name="ownerName"/><parameter name="startDate" type="String" default-value="2021-3-2"/><parameter name="endDate" type="String" default-value="2021-3-10"/></dataset><dataset name="users" type="sql"><sql><![CDATA[select b.id as userId,b.name as userName from ci_user b]]></sql><field name="userId"/><field name="userName"/></dataset><dataset name="failed" type="sql"><sql><![CDATA[SELECT teamName as 项目,project_name as 工程,failedStageName as 流水线失败阶段,
(case 
	when failedStageName ='checkout from scm' then '无法检出代码'
    when failedStageName ='maven build' then '编译错'
    when failedStageName ='npm build' then '编译错'
    when failedStageName = 'dependency check' then '依赖安全扫描失败'
    when failedStageName = 'sonar scan' then '源码质量扫描失败'
    else '其他错误'
 end
) as 失败原因,
(case 
	when failedStageName ='checkout from scm' then '1.确认源码仓库地址以及访问用户; 2.确认网络连通性'
    when failedStageName ='maven build' then '根据jenkins日志自行修复'
    when failedStageName ='npm build' then '根据jenkins日志自行修复'
    else '请查看jenkins日志获取详细信息，或联系管理员技术支持'
 end
) as 处理建议,
lastBuild as 最新构建时间 FROM v_team_build_failed
order by teamName,project_name]]></sql><field name="项目"/><field name="工程"/><field name="流水线失败阶段"/><field name="失败原因"/><field name="处理建议"/><field name="最新构建时间"/></dataset></datasource><paper type="A4" left-margin="90" right-margin="90"
    top-margin="72" bottom-margin="72" paging-mode="fitpage" fixrows="0"
    width="595" height="842" orientation="portrait" html-report-align="left" bg-image="" html-interval-refresh-value="0" column-enabled="false"></paper><search-form form-position="up"></search-form></ureport>